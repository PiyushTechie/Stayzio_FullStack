<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= user.username %> - Profile</title>
  <!-- Bootstrap & FontAwesome -->
  <link rel="stylesheet" href="/css/profile.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
 
  <div class="container mt-4 mb-5">
    <div class="row justify-content-center">
      <div class="col-lg-10">

        <!-- Profile Header -->
        <div class="profile-container p-0 mb-4">
          <div class="profile-header text-center">
            <i class="fa-solid fa-user-circle profile-avatar d-block mb-3"></i>
            <h2 class="mb-2"><%= user.username %></h2>
            
            <% if (isOwner) { %>
              <p class="mb-3 opacity-90"><i class="fa fa-envelope me-2"></i><%= user.email %></p>
              <p class="mb-3 opacity-90"><i class="fa fa-user me-2"></i><%= user.username %></p>
              
              <!-- Action Buttons -->
              <div class="d-flex justify-content-center gap-3 flex-wrap">
                <a href="/listings/new" class="btn btn-custom">
                  <i class="fa fa-plus me-2"></i>Add Listing
                </a>
                <a href="/logout" class="btn btn-outline-custom">
                  <i class="fa fa-sign-out-alt me-2"></i>Logout
                </a>
              </div>
            <% } %>

            <!-- Stats Grid -->
            <div class="stats-grid mt-4">
              <div class="stat-item">
                <div class="stat-number"><%= user.listings ? user.listings.length : 0 %></div>
                <div class="stat-label">Listings</div>
              </div>
              <div class="stat-item">
                <div class="stat-number"><%= user.reviews ? user.reviews.length : 0 %></div>
                <div class="stat-label">Reviews</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Listings Section -->
        <div class="section-card p-4">
          <h4 class="section-title">
            <i class="fa fa-home me-2"></i>
            <%= isOwner ? "My Listings" : (user.username + "'s Listings") %>
          </h4>
          
          <% if (user.listings && user.listings.length > 0) { %>
            <div class="row g-4">
              <% user.listings.forEach((listing, index) => { %>
                <div class="col-md-6" style="animation-delay: <%= index * 0.1 %>s;">
                  <div class="card listing-card p-4 h-100">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                      <h5 class="card-title mb-0"><%= listing.title %></h5>
                      <span class="badge bg-primary">Active</span>
                    </div>
                    <p class="text-muted mb-3">
                      <i class="fa fa-map-marker-alt me-2 text-danger"></i>
                      <%= listing.location %>
                    </p>
                    <div class="d-flex justify-content-between align-items-center mt-auto">
                      <small class="text-muted">
                        <i class="fa fa-calendar me-1"></i>
                        Listed recently
                      </small>
                      <a href="/listings/<%= listing._id %>" class="btn btn-outline-custom btn-sm">
                        <i class="fa fa-eye me-1"></i>View Details
                      </a>
                    </div>
                  </div>
                </div>
              <% }) %>
            </div>
          <% } else { %>
            <div class="text-center py-5">
              <i class="fa fa-home text-muted mb-3" style="font-size: 3rem; opacity: 0.5;"></i>
              <p class="text-muted mb-0">
                <%= isOwner ? "Ready to share your space? Add your first listing!" : "No listings to show yet." %>
              </p>
              <% if (isOwner) { %>
                <a href="/listings/new" class="btn btn-custom mt-3">
                  <i class="fa fa-plus me-2"></i>Create First Listing
                </a>
              <% } %>
            </div>
          <% } %>
        </div>

        <!-- Reviews Section -->
        <div class="section-card p-4">
          <h4 class="section-title">
            <i class="fa fa-star me-2"></i>
            <%= isOwner ? "My Reviews" : (user.username + "'s Reviews") %>
          </h4>
          
          <% if (user.reviews && user.reviews.length > 0) { %>
            <div class="row g-3">
              <% user.reviews.forEach((review, index) => { %>
                <div class="col-12" style="animation-delay: <%= index * 0.1 %>s;">
                  <div class="review-card p-4">
                    <div class="d-flex justify-content-between align-items-start">
                      <div class="flex-grow-1">
                        <div class="star-rating mb-2">
                          <% for (let i = 1; i <= 5; i++) { %>
                            <span style="color:<%= i <= review.rating ? '#ffd700' : '#e0e0e0' %>;">â˜…</span>
                          <% } %>
                          <!-- Removed numeric (x/5) -->
                        </div>
                        <p class="mb-2"><%= review.comment %></p>
                        <small class="text-muted">
                          <i class="fa fa-clock me-1"></i>
                          Recently reviewed
                        </small>
                      </div>
                      <a href="/listings/<%= review.listing %>" class="btn btn-outline-custom btn-sm ms-3">
                        <i class="fa fa-external-link-alt me-1"></i>View Listing
                      </a>
                    </div>
                  </div>
                </div>
              <% }) %>
            </div>
          <% } else { %>
            <div class="text-center py-5">
              <i class="fa fa-star text-muted mb-3" style="font-size: 3rem; opacity: 0.5;"></i>
              <p class="text-muted mb-0">
                <%= isOwner ? "Share your experiences! Write your first review." : "No reviews to display yet." %>
              </p>
            </div>
          <% } %>
        </div>

      </div>
    </div>
  </div>

  <script>
    // Fade-in animation for cards
    document.addEventListener('DOMContentLoaded', function() {
      const cards = document.querySelectorAll('.listing-card, .review-card');
      cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
          card.style.transition = 'all 0.6s ease';
          card.style.opacity = '1';
          card.style.transform = 'translateY(0)';
        }, index * 100);
      });
    });
  </script>

</body>
</html>
